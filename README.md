# Tutorial on dose-response meta-analysis  

### Abstract

`drmeta` can fit weighted mixed models based on tables of additive and multiplicative measures of association estimated using a common reference dose or exposure. Graph of the average and spread across studies of the predicted dose-response relationships is facilitated by the `drmeta_graph` post-estimation command. An application of `drmeta` is given in the context of a randomized dose in predicting the mean of a quantitative outcome. A curvilinear dose-response random-effect mechanism is estimated using restricted cubic splines and a degree-2 polynomial and presented with `drmeta_graph`.

### Aim 
This page is presenting the main features of the drmeta command and its companion drmeta_graph command for both estimation and visualization of dose-response models based on tables of empirical contrasts. Their use is illustrated using a simulated, yet realistic, scenario of a randomized dose in predicting a quantitative outcome in the presence of a curvilinear dose-response relationship and heterogeneity across studies.

### Availability

The `drmeta` command is freely available for download from the Statistical Software Components archive (`ssc install drmeta`). It is implemented as a Stata stand-alone command, cross-platform compatible, and requires Stata version 13 or higher (StataCorp, College Station, TX, USA). 

### Implementation 

`drmeta` is designed to estimate dose-response meta-analytical models based on tables of empirical contrasts using maximum likelihood methods. Additive and multiplicative measures such as mean differences, standardized mean differences, odds ratios, risk ratios, rate ratios, and hazard ratios serve as dependent variable. Their estimated variances and covariances define the study-specific weights to be used for each study in the mixed model. Multiplicative measures are modelled on the natural log scale. The allotted doses or assigned exposures serve as independent variable. 

The meta-analyst has to specify the possible shape of the dose-response relationship and whether this shape is assumed to be equal (fixed-effects or common-effects) or varying across studies (random-effects). If not specified otherwise, `drmeta` command is assuming a common and linear dose-response relationship underlying the studies. It is worth to mention that this default behavior of `drmeta` command is motivated only by computational speed. Arguably, non-linear and/or heterogeneous dose-response relationships across studies are more realistic assumptions in most real-life applications. The meta-analyst should aim at specifying a model that reflect the likely data generating mechanism within and between studies. In this regard, the `drmeta` command shows the maximized log-likelihood and the Akaike Information Criteria (AIC) that, together with substantive knowledge, can be used to compare alternative models. Regression splines, not necessarily cubic, can used to answer questions about certain characteristics of the dose-response relationship. 
Common options specified with drmeta command are the `id()` to identify sets of correlated contrasts within each study, `type()` to indicate the type of measure used as dependent variable, se() to pass the standard errors of the empirical contrasts, `data()` to pass basic descriptive statistics used to reconstruct the covariances of the empirical contrasts.

The `drmeta_graph` command uses all saved results left behind by the drmeta command and with an easy syntax is able to graph the predicted average as well as study-specific dose-response relationships. Realizations of the random effects are obtained with the Best Linear Unbiased Predictions (BLUP).1 As required options, the user has to specify a list of dose values in dose(), the reference dose in ref(), and the assumed parametric dose-response relationship in equation(). In case of complex transformations of the dose, such as restricted cubic splines, 6 drmeta_graph is able to reconstruct the values of the splines at the specified list of doses simply by passing a matrix of knots.  The option `addplot()` of the drmeta_graph command allows the user to overlay any parametric function even if not estimated by drmeta. This option can be useful, for example, when using spline functions and the meta-analyst wants to compare results with simpler parametric (i.e. linear, quadratic) functions. In the following example, we use `addplot()` option to overlay the true average dose-response mechanism underlying all the studies.

### Example: Table of estimated mean differences

Weighted mixed models are illustrated using an example based on tables of mean differences estimated from curvilinear random-effects scenario. Tables are generated by a Monte-Carlo simulation of individual data. Knowing the values of the parameters that govern the central tendency and spread of the dose-response relationships helps to evaluate the contribution of the drmeta and drmeta_graph commands in drawing inference on the dose-response data generating mechanisms underlying a collection of studies. Consider 50 tables of summarized data investigating the association between the randomly assigned dose and the mean of a quantitative response.  

```s
	use http://www.stats4life.se/data/md_drm.dta, clear
```

<img src="fig_data.png"  width="80%" height="80%" class="img-responsive center-block"/>
\includegraphics[width=\linewidth]{fig_data.png}

Let’s specify a dose-response model that 1) allow for curvilinear relationships by using transformations of the dose (splines, polynomials); and 2) allow for heterogeneity in true dose-response relationships across studies by adding random effects in the regression coefficients of the transformations of the dose. Figure 1 shows the drmeta output of two strategies: 

A) restricted cubic splines with 3 knots at fixed percentiles of the overall the dose distribution 

```s
    mkspline doses = dose, nk(3) cubic
    mat knots = r(knots)
    drmeta md doses1 doses2 , se(semd) data(n sd) id(id) type(type_md) ml
```

<img src="fig_spline.png"  width="50%" height="50%" class="img-responsive center-block"/>
  \includegraphics[width=\linewidth]{fig_spline.png}
  
B) degree-2 polynomial (i.e. quadratic trend)

```s
    gen dosesq = dose^2
    drmeta md dose dosesq , se(semd) data(n sd) id(id) type(type_md) ml
```

<img src="fig_quad.png"  width="50%" height="50%" class="img-responsive center-block"/>
  \includegraphics[width=\linewidth]{fig_quad.png}
  
 The estimated parameters (2 regression coefficients and 3 variance/covariances of the random effects) under the two modelling strategies are quite different. Therefore, the meta-analyst may expect that the predicted shape of the dose-response relationship under the two modelling strategies will be also very different. On the other hand, summary statistics of the two fitted models (maximized log-likelihoods, AICs, Wald-type tests of overall no dose-response relationship) are very similar, suggesting that data appear to be equally compatible with the two modelling strategies. At this point, the drmeta_graph can be extremely useful to tabulate and/or graph the predicted dose-response relationships using a common reference dose. Supplementary Figure S1 shows, for the spline model, how to obtain a table and a graph of the average dose-response relationship with 95% confidence intervals for every value of the dose ranging from 1 to 10 units where the dose of 2 units serves as referent  In the average study, for example, the predicted mean difference comparing 5 vs 2 units of the dose is equal to MD_5,2=-0.06(5-2)+0.17(0.571 -0.0003) = 3.19 with an estimated 95% confidence interval ranging from 1.17 to 5.20. Similar code and output for the estimated degree-2 polynomial model is shown in Supplementary Figure S2. In the average study, the predicted mean difference comparing 5 vs 2 units of the dose is equal to MD_5,2=-0.06(5-2)+0.17(5^2-2^2) = 3.30 with an estimated 95% confidence interval ranging from 1.23 to 5.37. 
 
It is clear that although starting from two very different sets of estimated parameters, the two modelling strategies lead to similar statistical inference on the shape of the dose-response relationship. In an average study, the change in mean response associated with one additional unit of the dose is progressively increasing at higher values of the dose. For example, based on degree-2 polynomial, the average mean difference comparing 3 vs 2 units of the dose is MD_3,2=0.77 , which is about a half of the average mean difference comparing 6 vs 5 units of the dose; MD_6,5=1.77. 
The fact that two modelling strategies leads to similar results is somewhat reassuring but, in real-life applications, it is not known to what extent any estimated dose-response relationship is far away from the true data generating dose-response mechanism operating, at least on average, in the population of studies of interest.  Since this is known in the 50 studies obtained with a Monte Carlo simulation, we use the addplot() option of drmeta_graph to add in the plot region the true average dose-response function, that is MD_(x,2)=0(x-2)+0.2(x^2-2^2 )   for a generic level x of the dose.  The true average dose-response function (black long dashed curve) is stronger than what has been estimated with both modelling strategies (black solid curves) (Supplementary Figure S1, Supplementary Figure S2). Nevertheless, the true average mean difference appear to fall within the estimated confidence intervals of the predicted average mean difference. For example, the true average mean difference comparing 5 vs 2 units MD_5,2=0(5-2)+2(5^2-2^2) = 4.20 falls within the estimated 95% confidence interval of either the spline or degree-2 polynomial model. 
Figure 2 shows the 50 predicted study-specific dose-response relationships (thin grey lines) obtained with empirical BLUPs of the random-effects based on their estimated variances/covariances in the weighted mixed model. The figure is obtained simply by adding the blup option in drmeta_graph. Figure 2 presents the entire distribution of dose-response relationships arising from the studies and not just their average. The meta-analyst can immediately appreciate the extent of the variation in dose-response relationships across studies. There are some studies with a dose-response association much stronger than the average study (grey lines above the black line), others indicating overall no association (flat grey lines), and other studies presenting a negative dose-response association (grey lines below the black line). The magnitude of this variability across studies has been taken into account in the above inference on the average dose-response relationship. Figure 2 shows that the uncertainty estimated for the average dose-response relationship (black dashed curves) is much smaller when compared to the spread of dose-response relationships across studies (grey curves) for any dose values being compared.  The pointwise distribution of mean differences (spread of thin grey curves around the average black line) at any value of the dose can be derived from the estimated mean and spread of the regression coefficients together with the normal approximation of the random effects.
Consider one more time the mean difference, in the average study, comparing 5 vs 2 units of the dose equal to MD_5,2=3.30 from the degree-2 polynomial model. Based on the estimated variances and covariance of the random effects (Supplementary Figure S2), the meta-analyst should not be surprised that, for example, one-third of the studies report a negative association (MD_5,2<0) and the other two-thirds of the studies report a positive association (〖MD〗_5,2>0). This pointwise variation in mean differences across studies is perfectly compatible with a positive association for the average study. 

### Final remarks

The `drmeta` command estimates weighted mixed effects models for statistical inference on dose-response relationships based on multiple tables of correlated empirical findings.  The complementary drmeta_graph command is extremely valuable to interpret and present a distribution, central tendency and spread, of the estimated dose-response relationships in tabular or graphical forms.  
The analysis of the 50 studies makes it clear that the meta-analyst has to move beyond interpretation of single parameters in isolation from the rest. The estimates of the parameters varied greatly according to the specified dose-response model (splines, polynomials) but the statistical inference drawn from it was substantially the same. It can be worth to note that a dose-response model that allow for non-linearity using some flexible transformations of the dose (splines, polynomial) does not imply that the predicted dose-response relationship has to be necessarily a curve. The example shows that uncertainty about the dose-response relationship for the average study can be a relatively minor issue relative to the overall variation of study-specific dose-response relationships across studies. In this regard, the contribution of drmeta_graph command for the interpretation of the assumed dose-response model is unique and complex graphs can be obtained with minimal coding effort.
The strength of the drmeta command is that can be used with a variety of study designs and type of measures (mean differences, standardized mean differences, odds ratios, risk ratios, rate ratios, and hazard ratios). The drmeta’s help file contains worked examples of dose-response meta-analysis based on prospective cohort studies and randomized trials 6,8,9. 
One limitation of drmeta command (version 1.0) is that estimation of weighted mixed models does not allow interaction of the dose with factors that may have an impact of the shape of the dose-response relationship. To explore possible sources of heterogeneity, the meta-analyst can simply stratify the dose-response analysis on study characteristics (i.e. geographical area, publication year, gender, exposure definition) using the if qualifier.

### References

1. 	Crippa A, Discacciati A, Bottai M, Spiegelman D, Orsini N. One-stage dose-response meta-analysis for aggregated data. Stat Methods Med Res. 2019 May;28(5):1579–96. 
2. 	Sera F, Armstrong B, Blangiardo M, Gasparrini A. An extended mixed-effects framework for meta-analysis. Stat Med. 2019;38(29):5429–44. 
3. 	Orsini N, Bellocco R, Greenland S. Generalized least squares for trend estimation of summarized dose-response data. Stata J. 2006;6(1):40–57. 
4. 	Crippa A, Orsini N. Multivariate Dose-Response Meta-Analysis: The dosresmeta R Package. J Stat Softw. 2016 Aug 16;72(1):1–15. 
5. 	Ruifeng L, Spiegelman D. %metadose [Internet]. 2012 [cited 2019 May 3]. Available from: https://www.hsph.harvard.edu/donna-spiegelman/software/metadose/
6. 	Orsini N, Li R, Wolk A, Khudyakov P, Spiegelman D. Meta-analysis for linear and nonlinear dose-response relations: examples, an evaluation of approximations, and software. Am J Epidemiol. 2012 Jan 1;175(1):66–73. 
7. 	Orsini N, Spiegelman D. Meta-analysis of dose-response relationships. In: Schmid CH, Stijnen T, White I, editors. Handbook of Meta-Analysis. 1 edition. Chapman and Hall/CRC; 2020. 
8. 	Crippa A, Orsini N. Dose-response meta-analysis of differences in means. BMC Med Res Methodol. 2016 02;16:91. 
9. 	Leucht S, Crippa A, Siafis S, Patel MX, Orsini N, Davis JM. Dose-Response Meta-Analysis of Antipsychotic Drugs for Acute Schizophrenia. Am J Psychiatry. 2019 Dec 16;appiajp201919010034. 
